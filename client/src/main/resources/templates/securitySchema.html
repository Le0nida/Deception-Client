<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Includi jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script th:src="@{/js/utils.js}"></script>
    <script th:src="@{/js/specificationInfos.js}"></script>
    <title>OpenAPI 3.0 Security Scheme Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input {
            margin-bottom: 10px;
            width: 100%;
            padding: 5px;
        }
        button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>

<h2>OpenAPI 3.0 Security Scheme Editor</h2>

<form id="securitySchemeForm">
    <label for="type">Type:</label>
    <input type="text" id="type" name="type" placeholder="e.g., apiKey">

    <label for="description">Description:</label>
    <input type="text" id="description" name="description" placeholder="Enter a description">

    <label for="name">Name:</label>
    <input type="text" id="name" name="name" placeholder="e.g., api_key">

    <label for="in">In:</label>
    <input type="text" id="in" name="in" placeholder="e.g., header or query">

    <label for="scheme">Scheme:</label>
    <input type="text" id="scheme" name="scheme" placeholder="e.g., basic or bearer">

    <label for="bearerFormat">Bearer Format:</label>
    <input type="text" id="bearerFormat" name="bearerFormat" placeholder="e.g., JWT">

    <label for="openIdConnectUrl">OpenId Connect URL:</label>
    <input type="text" id="openIdConnectUrl" name="openIdConnectUrl" placeholder="Enter authorization URL">

    <h4>Flows</h4>
    <div id="addedFlow"></div>
    <div id="oauthFlowForm">
        <label for="authorizationUrl">Authorization URL:</label>
        <input type="text" id="authorizationUrl" name="authorizationUrl" placeholder="Enter authorization URL">

        <label for="tokenUrl">Token URL:</label>
        <input type="text" id="tokenUrl" name="tokenUrl" placeholder="Enter token URL">

        <label for="refreshUrl">Refresh URL:</label>
        <input type="text" id="refreshUrl" name="refreshUrl" placeholder="Enter refresh URL">

        <label for="scopes">Scopes (comma-separated):</label>
        <input type="text" id="scopes" name="scopes" placeholder="e.g., read,write">

        <button type="button" onclick="generateOAuthFlow()">Generate OAuth Flow</button>
    </div>

    <button type="button" onclick="generateSecurityScheme()">Generate Security Scheme</button>
</form>

<script>

    const flows = new Map

    function generateOAuthFlow() {
        // Collect data from form inputs
        var authorizationUrl = document.getElementById('authorizationUrl').value;
        var tokenUrl = document.getElementById('tokenUrl').value;
        var refreshUrl = document.getElementById('refreshUrl').value;
        var scopes = document.getElementById('scopes').value.split(',');

        // Create OAuth Flow object
        var oauthFlow = {
            authorizationUrl: authorizationUrl,
            tokenUrl: tokenUrl,
            refreshUrl: refreshUrl,
            scopes: {}
        };

        // Populate scopes
        scopes.forEach(function (scope) {
            var trimmedScope = scope.trim();
            if (trimmedScope !== '') {
                oauthFlow.scopes[trimmedScope] = ''; // You can add descriptions for each scope if needed
            }
        });

        // Log the generated OAuth Flow object (you can send it to the server or use it as needed)
        console.log(oauthFlow);
    }

    function generateSecurityScheme() {
        // Collect data from form inputs
        var type = document.getElementById('type').value;
        var description = document.getElementById('description').value;
        var name = document.getElementById('name').value;
        var inValue = document.getElementById('in').value;
        var scheme = document.getElementById('scheme').value;
        var bearerFormat = document.getElementById('bearerFormat').value;

        // Common fields for most security schemes
        var securityScheme = {
            type: type,
            description: description,
            name: name,
            in: inValue,
            scheme: scheme,
            bearerFormat: bearerFormat
            // Add more common fields based on the specific security scheme
        };

        // Additional fields for OAuth 2.0
        if (type.toLowerCase() === 'oauth2') {
            var authorizationUrl = document.getElementById('authorizationUrl').value;
            var tokenUrl = document.getElementById('tokenUrl').value;
            var refreshUrl = document.getElementById('refreshUrl').value;

            securityScheme.flows = {
                authorizationCode: {
                    authorizationUrl: authorizationUrl,
                    tokenUrl: tokenUrl,
                    refreshUrl: refreshUrl
                    // Add more OAuth-specific fields based on the specific security scheme
                }
            };
        }

        // Log the generated Security Scheme object (you can send it to the server or use it as needed)
        console.log(securityScheme);
    }

    // Show/hide OAuth-specific fields based on the selected security scheme type
    document.getElementById('type').addEventListener('change', function () {
        var typeValue = this.value.toLowerCase();
        if (typeValue === 'oauth2') {
            document.getElementById('commonFields').style.display = 'none';
            document.getElementById('oauthFields').style.display = 'block';
        } else {
            document.getElementById('commonFields').style.display = 'block';
            document.getElementById('oauthFields').style.display = 'none';
        }
    });
</script>

</body>
</html>
